<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="Create and share sewing patterns">
    <meta name="author" content="Fabian Kirchner">
    <meta name="theme-color" content="#268484">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta property="og:image" content="/static/icon-512.png">
    <link rel="stylesheet" href="/static/main.css">
    <link rel="manifest" href="/static/manifest.webmanifest">

    <script src="/static/elm.js"></script>
    <script>
      const initElm = () => {
        var app = Elm.Main.init({
          flags: {}
        });

        if (app.ports.selectAllTextIn) {
          app.ports.selectAllTextIn.subscribe(id => {
            window.requestAnimationFrame(() => {
              const input = document.getElementById(id);

              if (input !== null) {
                input.select();
              }
            });
          });
        }

        if (app.ports.storeCache) {
          app.ports.storeCache.subscribe(function(data) {
            localStorage.setItem(data.key, data.value);

            setTimeout(function() {
              app.ports.onStoreChange.send({ key: data.key, value: data.value });
            }, 0);
          });
        }

        if (app.ports.requestCache) {
          app.ports.requestCache.subscribe(function(data) {
            var value = localStorage.getItem(data.key);

            if (value !== null) {
              app.ports.onStoreChange.send({ key: data.key, value: value });
            } else {
              app.ports.onStoreMissing.send({ key: data.key });
            }
          });
        }

        window.addEventListener("storage", function(event) {
          if (event.storageArea === localStorage) {
            if (app.ports.onStoreChange) {
              app.ports.onStoreChange.send({ key: event.key, value: event.newValue });
            }
          }
        });

        return app;
      };

      // Registering Service Worker
      if('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/service-worker.js');
      };

      window.addEventListener("DOMContentLoaded", function() {
        initElm();
      });
    </script>
  </head>
  <body>
  </body>
</html>
